import{_ as o,c,j as e,a,I as n,w as r,as as l,D as p,o as d}from"./chunks/framework.BBmOMSeO.js";const sa=JSON.parse('{"title":"Minecraft 服务器优化指南","description":"","frontmatter":{},"headers":[],"relativePath":"Mc/Purpur-1.20.1/优化-2.md","filePath":"Mc/Purpur-1.20.1/优化-2.md","lastUpdated":1721809173000}'),h={name:"Mc/Purpur-1.20.1/优化-2.md"},u=e("h1",{id:"minecraft-服务器优化指南",tabindex:"-1"},[a("Minecraft 服务器优化指南 "),e("a",{class:"header-anchor",href:"#minecraft-服务器优化指南","aria-label":'Permalink to "Minecraft 服务器优化指南"'},"​")],-1),b=e("p",null,[a("注意：对于使用原版、Fabric 或 Spigot（或低于 Paper）的用户，请进入你的 "),e("code",null,"server.properties"),a(" 文件并将 "),e("code",null,"sync-chunk-writes"),a(" 更改为 "),e("code",null,"false"),a("。在 Paper 及其分支上，此选项会被强制设置为 false，但在其他服务器实现上你需要手动将其设置为 false。这样可以让服务器在主线程之外保存区块，减轻主循环的负载。")],-1),m=e("p",null,"适用于 1.20 版本的指南。部分内容可能仍适用于 1.15 - 1.19。",-1),f=l("",7),g=e("p",null,"应避免使用：",-1),k=e("li",null,"任何声称异步处理的付费服务器 JAR - 99.99% 是骗局。",-1),_=e("li",null,"Bukkit/CraftBukkit/Spigot - 性能上与其他可用服务器软件相比极其过时。",-1),v=e("li",null,"许多进一步下游的 Pufferfish 或 Purpur 分支会遇到不稳定和其他问题。如果你寻求更多的性能提升，请优化你的服务器或投资个人私有分支。",-1),q=e("h2",{id:"地图预生成",tabindex:"-1"},[a("地图预生成 "),e("a",{class:"header-anchor",href:"#地图预生成","aria-label":'Permalink to "地图预生成"'},"​")],-1),w=e("p",null,"由于多年来对区块生成所做的各种优化，地图预生成现在仅在 CPU 性能糟糕、单线程或受限的服务器上有用。不过，预生成通常用于生成如 Pl3xMap 或 Dynmap 等世界地图插件的区块。",-1),P=l("",12),x=e("br",null,null,-1),y=l("",80),C=e("p",null,[a("此选项决定指定的行为和传感器以刻为单位的触发频率。村民的 "),e("code",null,"acquirepoi"),a(" 似乎是最重的行为，因此大大增加了时间间隔。如果村民在找到路径时遇到问题，请减少此值。")],-1),T=e("h3",{id:"pufferfish-yml-1",tabindex:"-1"},[a("[pufferfish.yml] "),e("a",{class:"header-anchor",href:"#pufferfish-yml-1","aria-label":'Permalink to "[pufferfish.yml]"'},"​")],-1),A=e("h4",{id:"dab-enabled",tabindex:"-1"},[a("dab.enabled "),e("a",{class:"header-anchor",href:"#dab-enabled","aria-label":'Permalink to "dab.enabled"'},"​")],-1),S=e("p",null,[e("code",null,"推荐初始值：true")],-1),I=l("",48),V=e("code",null,"ALTERNATE_CURRENT",-1),M=l("",46),N=l("",5),D=e("code",null,"SOG",-1),E=e("p",null,[a("此外，在启动参数中在 "),e("code",null,"-jar"),a(" 之前添加测试标志 "),e("code",null,"--add-modules=jdk.incubator.vector"),a(" 可以提高性能。此标志使 Pufferfish 能够在你的 CPU 上使用 SIMD 指令，使一些数学运算更快。目前，它仅用于使游戏插件地图（如 imageonmaps）的渲染速度提高最多 8 倍。")],-1),z=e("h1",{id:"好得令人难以置信的插件",tabindex:"-1"},[e("code",null,"好得令人难以置信"),a("的插件 "),e("a",{class:"header-anchor",href:"#好得令人难以置信的插件","aria-label":'Permalink to "`好得令人难以置信`的插件"'},"​")],-1),R=e("h2",{id:"扫地插件",tabindex:"-1"},[a("扫地插件 "),e("a",{class:"header-anchor",href:"#扫地插件","aria-label":'Permalink to "扫地插件"'},"​")],-1),j=e("h2",{id:"生物堆叠插件",tabindex:"-1"},[a("生物堆叠插件 "),e("a",{class:"header-anchor",href:"#生物堆叠插件","aria-label":'Permalink to "生物堆叠插件"'},"​")],-1),B=e("p",null,"很难证明使用此类插件的合理性。堆叠自然生成的实体比不堆叠它们引起更多的卡顿，因为服务器会不断尝试生成更多的生物。唯一“可接受”的用例是用于大量刷怪笼的服务器。",-1),J=e("h2",{id:"启用-禁用其他插件的插件",tabindex:"-1"},[a("启用/禁用其他插件的插件 "),e("a",{class:"header-anchor",href:"#启用-禁用其他插件的插件","aria-label":'Permalink to "启用/禁用其他插件的插件"'},"​")],-1),U=e("code",null,"/reload",-1),G=l("",4),O=e("h2",{id:"timings",tabindex:"-1"},[a("Timings "),e("a",{class:"header-anchor",href:"#timings","aria-label":'Permalink to "Timings"'},"​")],-1),L=e("p",null,"查看服务器卡顿时可能发生了什么的方式之一是 Timings。Timings 是一个工具，它让你看到哪些任务花费的时间最长。这是最基本的故障排除工具，如果你请求有关卡顿的帮助，你很可能会被要求提供 Timings。已知 Timings 对服务器有严重的性能影响，建议使用 Spark 插件而不是 Timings，并使用 Purpur 或 Pufferfish 完全禁用 Timings。",-1),$=e("code",null,"/timings paste",-1),F=e("hr",null,null,-1),H=e("h1",{id:"minecraft-漏洞及其修复方法",tabindex:"-1"},[a("Minecraft 漏洞及其修复方法 "),e("a",{class:"header-anchor",href:"#minecraft-漏洞及其修复方法","aria-label":'Permalink to "Minecraft 漏洞及其修复方法"'},"​")],-1),Q=e("code",null,"SOG",-1);function Y(K,W,X,Z,aa,ea){const s=p("VPNolebaseInlineLinkPreview"),i=p("NolebaseGitContributors"),t=p("NolebaseGitChangelog");return d(),c("div",null,[u,b,m,e("p",null,[a("基于"),n(s,{href:"https://www.spigotmc.org/threads/guide-server-optimization%E2%9A%A1.283181/",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("此指南")]),_:1}),a("和其他来源（所有相关链接在指南中均有提及）。")]),f,e("ul",null,[e("li",null,[n(s,{href:"https://github.com/PaperMC/Paper",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("Paper")]),_:1}),a(" - 最流行的服务器软件，旨在提高性能，同时修复游戏和机制不一致的问题。")]),e("li",null,[n(s,{href:"https://github.com/pufferfish-gg/Pufferfish",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("Pufferfish")]),_:1}),a(" - Paper 的分支，旨在进一步提高服务器性能。")]),e("li",null,[n(s,{href:"https://github.com/PurpurMC/Purpur",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("Purpur")]),_:1}),a(" - Pufferfish 的分支，专注于功能和自定义自由度。")])]),g,e("ul",null,[k,_,e("li",null,[a("任何在运行时启用/禁用/重载插件的软件。请参阅"),n(s,{href:"#启用-禁用其他插件的插件"},{default:r(()=>[a("本节")]),_:1}),a("了解原因。")]),v]),q,w,e("p",null,[a("如果你仍然想预生成世界，可以使用如 "),n(s,{href:"https://github.com/pop4959/Chunky",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("Chunky")]),_:1}),a(" 这样的插件来实现。确保设置世界边界，以防止玩家生成新区块！请注意，根据你在预生成插件中设置的半径，预生成有时可能需要数小时。请记住，使用 Paper 及以上版本时，tps 不会受到区块加载的影响，但当服务器的 CPU 过载时，加载区块的速度会显著下降。")]),P,e("blockquote",null,[e("p",null,[a("启用此选项会每秒向玩家发送一个保持连接数据包，并且只有在 30 秒内没有响应任何一个数据包时才会超时。响应任何一个数据包将保持玩家连接。换句话说，它不会因为某个数据包在传输过程中丢失而踢出玩家。"),x,a(" ~ "),n(s,{href:"https://purpurmc.org/docs/Configuration/#use-alternate-keepalive",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("https://purpurmc.org/docs/Configuration/#use-alternate-keepalive")]),_:1})])]),y,e("blockquote",null,[e("p",null,[a("在启用 "),n(s,{href:"#dabenabled"},{default:r(()=>[a("Pufferfish 的 DAB")]),_:1}),a(" 时，不建议更改这些值！")])]),C,T,A,S,e("p",null,[a("DAB（大脑动态激活）减少了远离玩家的实体的处理次数。DAB 以渐变方式工作，而不是像 EAR 那样的硬性截止。DAB 将根据 "),n(s,{href:"#dabactivation-dist-mod"},{default:r(()=>[a("dab.activation-dist-mod")]),_:1}),a(" 的计算结果减少实体的处理次数。")]),I,e("p",null,[V,a(" 实现基于 "),n(s,{href:"https://modrinth.com/mod/alternate-current",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("Alternate Current")]),_:1}),a(" 模组。有关此算法的更多信息可以在他们的资源页面找到。")]),M,e("p",null,[a("启用此选项可以隐藏矿石，防止透视作弊玩家发现。有关此功能的详细配置，请查看"),n(s,{href:"https://docs.papermc.io/paper/anti-xray",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("配置反透视")]),_:1}),a("。启用此选项实际上会降低性能，但它比任何反透视插件都更高效。在大多数情况下，性能影响可以忽略不计。")]),N,e("p",null,[n(s,{href:"https://docs.papermc.io/java-install-update",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("原版 Minecraft 和 Minecraft 服务器软件在 1.20.5+ 版本中需要 Java 21 或更高版本")]),_:1}),a("。Oracle 改变了他们的许可协议，现在没有理由非要从他们那里获取 Java。推荐的供应商是 "),n(s,{href:"https://adoptium.net/",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("Adoptium")]),_:1}),a(" 和 "),n(s,{href:"https://aws.amazon.com/corretto/",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("Amazon Corretto")]),_:1}),a("。虽然 OpenJ9 或 GraalVM 等替代 JVM 实现也可以使用，但它们不受 Paper 支持，并且已知会导致问题，因此目前不建议使用。")]),e("p",null,[a("你可以配置垃圾回收器以减少大规模垃圾回收任务引起的卡顿。你可以在"),n(s,{href:"https://docs.papermc.io/paper/aikars-flags",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("这里")]),_:1}),a("找到适用于 Minecraft 服务器的启动参数 ["),D,a("]。请记住，这些推荐参数不适用于替代 JVM 实现。 建议使用 "),n(s,{href:"https://flags.sh",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("flags.sh")]),_:1}),a(" 启动参数生成器来获取适合你服务器的启动参数。")]),E,z,R,e("p",null,[a("完全没有必要，因为它们可以被 "),n(s,{href:"#merge-radius"},{default:r(()=>[a("merge-radius")]),_:1}),a(" 和 "),n(s,{href:"#alt-item-despawn-rate"},{default:r(()=>[a("alt-item-despawn-rate")]),_:1}),a(" 取代，坦率地说，它们的可配置性不如基本的服务器配置。这些插件扫描和移除物品所花费的资源比不移除物品还多。")]),j,B,J,e("p",null,[a("任何在运行时启用或禁用插件的行为都是极其危险的。加载此类插件可能会导致跟踪数据的致命错误，禁用插件可能会因为移除依赖项而导致错误。"),U,a(" 命令也存在相同的问题，你可以在"),n(s,{href:"https://madelinemiller.dev/blog/problem-with-reload/",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("me4502 的博客文章")]),_:1}),a("中了解更多。")]),G,e("p",null,[n(s,{href:"https://spark.lucko.me/",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("Spark")]),_:1}),a(" 是一个允许你分析服务器 CPU 和内存使用情况的插件。你可以在"),n(s,{href:"https://spark.lucko.me/docs/",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("其维基")]),_:1}),a("上了解如何使用它。还有一个关于如何找到卡顿原因的指南，参见"),n(s,{href:"https://spark.lucko.me/docs/guides/Finding-lag-spikes",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("这里")]),_:1}),a("。")]),O,L,e("p",null,[a("要获取服务器的 Timings，只需执行 "),$,a(" 命令并点击提供的链接。你可以与他人分享此链接以便他们帮助你。如果你不知道自己在做什么，这也很容易被误读。Aikar 有一个详细的"),n(s,{href:"https://www.youtube.com/watch?v=T4J0A9l7bfQ",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("视频教程")]),_:1}),a("，教你如何阅读它们。")]),F,H,e("p",null,[a("要了解如何修复可能导致卡顿或崩溃的 Minecraft 服务器漏洞，请参见"),n(s,{href:"https://github.com/YouHaveTrouble/minecraft-exploits-and-how-to-fix-them",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("这里")]),_:1}),a("。")]),e("p",null,[n(s,{href:"https://www.spigotmc.org/threads/guide-server-optimization%E2%9A%A1.283181/",target:"_blank",rel:"noreferrer"},{default:r(()=>[Q]),_:1})]),e("p",null,[n(s,{href:"https://docs.papermc.io/paper/reference/server-properties",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("server.properties")]),_:1})]),e("p",null,[n(s,{href:"https://docs.papermc.io/paper/reference/bukkit-configuration",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("bukkit.yml")]),_:1})]),e("p",null,[n(s,{href:"https://docs.papermc.io/paper/reference/spigot-configuration",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("spigot.yml")]),_:1})]),e("p",null,[n(s,{href:"https://docs.papermc.io/paper/reference/global-configuration",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("paper-global configuration")]),_:1})]),e("p",null,[n(s,{href:"https://docs.papermc.io/paper/reference/world-configuration",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("paper-world configuration")]),_:1})]),e("p",null,[n(s,{href:"https://purpurmc.org/docs/Configuration/",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("purpur.yml")]),_:1})]),e("p",null,[n(s,{href:"https://docs.pufferfish.host/setup/pufferfish-fork-configuration/",target:"_blank",rel:"noreferrer"},{default:r(()=>[a("pufferfish.yml")]),_:1})]),n(i),n(t)])}const ra=o(h,[["render",Y]]);export{sa as __pageData,ra as default};
